<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gedo Sites – GPS Dots Map</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    #map { height: 100%; min-height: 420px; }
  </style>
</head>
<body class="bg-slate-100">
  <div id="app" class="h-screen grid md:grid-cols-[360px_1fr]">
    <!-- Sidebar -->
    <aside class="bg-white border-r border-slate-200 p-4 flex flex-col gap-4">
      <header>
        <h1 class="text-xl font-bold text-slate-800">Gedo Sites – GPS Dots</h1>
        <p class="text-sm text-slate-500">MoEWR-JSS & line ministries sites (Water/Meat/Agriculture).</p>
      </header>

      <div class="space-y-3">
        <button id="locateMe"
          class="w-full rounded-xl bg-blue-600 px-4 py-2 text-white font-semibold shadow hover:bg-blue-500">
          Use My GPS Location
        </button>
      </div>

      <div class="mt-2">
        <h2 class="text-sm font-semibold text-slate-600 mb-2">Locations (click “Zoom”)</h2>
        <ul id="pointsList" class="space-y-2 text-sm text-slate-700"></ul>
      </div>

      <footer class="mt-auto text-xs text-slate-400">
        Tip: For GPS, open this page via <b>http://localhost</b> or <b>https://</b> (not file://).
      </footer>
    </aside>

    <!-- Map -->
    <main class="relative h-full">
      <div id="map" class="absolute inset-0 h-full"></div>
    </main>
  </div>

  <script>
    // --- Your data (from the table) ---
    // Rows without coordinates are kept in the list with a "No GPS" badge.
    const sites = [
      // 1) Gedo / Garbaharrey / Hashawer — no GPS given
    //   {
    //     sn: 1, region: "Gedo", district: "Garbaharrey", siteName: "Hashawer",
    //     lineMinistry: "MoEWR-JSS", category: "Water",
    //     contact: "Alamin Abdinur Dirie", phone: "613366998",
    //     publicPrivate: "", space: "", electricity: "", price: "", hours: "", users: "",
    //     lat: null, lng: null
    //   },
      // 2) Bardere – Meat Market
      {
        sn: 2, region: "Gedo", district: "Bardere", siteName: "Meat Market",
        lineMinistry: "MoLFR-JSS", category: "Meat market",
        contact: "Ibrahim Nur Ismail", phone: "618929533",
        publicPrivate: "Public", space: "30m×20m", electricity: "Bardera Electricity",
        price: "$50", hours: "10", users: "60",
        lat: 2.336019, lng: 42.285309
      },
      // 3) Dollow – Meat Market
      {
        sn: 3, region: "Gedo", district: "Dollow", siteName: "Meat Market",
        lineMinistry: "MoLFR-JSS", category: "Meat market",
        contact: "Mohamed Abdullahi Kusow", phone: "615163115",
        publicPrivate: "Public", space: "20m×5m", electricity: "No electricity",
        price: "0", hours: "10", users: "70",
        lat: 4.16404, lng: 42.090664
      },
      // 4) Garbaharrey – Meat Market
      {
        sn: 4, region: "Gedo", district: "Garbaharrey", siteName: "Meat Market",
        lineMinistry: "MoLFR-JSS", category: "Meat market",
        contact: "Alamin Abdinur Dirie", phone: "613366998",
        publicPrivate: "Public", space: "20m×20m", electricity: "No electricity",
        price: "0", hours: "6", users: "50",
        lat: 3.331583, lng: 42.220376
      },
      // 5) Luuq – Milk Market
      {
        sn: 5, region: "Gedo", district: "Luuq", siteName: "Milk Market",
        lineMinistry: "MoLFR-JSS", category: "Meat market",
        contact: "Siyad Ismail Mohamed", phone: "615082833",
        publicPrivate: "Public", space: "20m×15m", electricity: "Juba Electricity",
        price: "$25", hours: "12", users: "250",
        lat: 3.795055, lng: 42.544286
      },
      // 6) Dollow – Milk Market
      {
        sn: 6, region: "Gedo", district: "Dollow", siteName: "Milk Market",
        lineMinistry: "MoLFR-JSS", category: "Meat market",
        contact: "Mohamed Abdullahi Kusow", phone: "615163115",
        publicPrivate: "Public", space: "20m×15m", electricity: "No electricity",
        price: "0", hours: "10", users: "25",
        lat: 4.163188, lng: 42.075776
      },
      // 7) Luuq – Hanoy (no GPS)
      {
        sn: 7, region: "Gedo", district: "Luuq", siteName: "Hanoy",
        lineMinistry: "MoAI-JSS", category: "Agriculture",
        contact: "Noor Aden Mohumed", phone: "",
        publicPrivate: "", space: "", electricity: "", price: "", hours: "", users: "",
        lat: 3.746533,  lng: 42.543454
      },
      // 8) Bardere – Qalaliyow (no GPS)
      {
        sn: 8, region: "Gedo", district: "Bardere", siteName: "Qalaliyow",
        lineMinistry: "MoAI-JSS", category: "Agriculture",
        contact: "Dalmar Hassan Adan", phone: "615953616",
        publicPrivate: "", space: "", electricity: "", price: "", hours: "", users: "",
        lat: 2.352431,  lng: 42.280226
      }
      // 9,10 were blank in the sheet
    ];

    // --- Map setup ---
    const map = L.map('map', { zoomControl: true, attributionControl: true });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 20,
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    const dotStyle = { radius: 6, color: "#1f2937", fillColor: "#2563eb", fillOpacity: 0.9, weight: 1 };
    const meStyle  = { radius: 7, color: "#064e3b", fillColor: "#10b981", fillOpacity: 0.95, weight: 2 };

    const bounds = [];
    const pointsList = document.getElementById('pointsList');

    function addDotForSite(s) {
      const { lat, lng } = s;
      const label = `${s.siteName} – ${s.district}`;
      const popup = `
        <div class="text-sm">
          <div class="font-semibold">${s.siteName} <span class="text-slate-500">(${s.category})</span></div>
          <div class="text-slate-600">${s.district}, ${s.region}</div>
          <hr class="my-1" />
          <div><b>Line Ministry:</b> ${s.lineMinistry || "-"}</div>
          <div><b>Contact:</b> ${s.contact || "-"} ${s.phone ? "(" + s.phone + ")" : ""}</div>
          <div><b>Electricity:</b> ${s.electricity || "-"}</div>
          <div><b>Space:</b> ${s.space || "-"}</div>
          <div><b>Price/Month:</b> ${s.price || "-"}</div>
          <div><b>Hours:</b> ${s.hours || "-"}</div>
          <div><b>Users:</b> ${s.users || "-"}</div>
          <div class="mt-1 text-slate-500">${lat.toFixed(6)}, ${lng.toFixed(6)}</div>
        </div>`;

      const m = L.circleMarker([lat, lng], dotStyle).addTo(map).bindPopup(popup);
      bounds.push([lat, lng]);

      // Sidebar row
      const li = document.createElement('li');
      li.className = "flex items-center justify-between gap-3 rounded-lg bg-slate-50 border border-slate-200 px-2 py-1";
      li.innerHTML = `
        <div class="min-w-0">
          <div class="font-medium truncate">${label}</div>
          <div class="text-xs text-slate-500 truncate">${lat.toFixed(5)}, ${lng.toFixed(5)}</div>
        </div>
        <button class="shrink-0 text-blue-600 hover:underline text-xs">Zoom</button>`;
      li.querySelector('button').addEventListener('click', () => {
        map.setView([lat, lng], 15, { animate: true }); m.openPopup();
      });
      pointsList.appendChild(li);
    }

    function addListRowWithoutGPS(s) {
      const li = document.createElement('li');
      li.className = "flex items-center justify-between gap-3 rounded-lg bg-slate-50 border border-rose-200 px-2 py-1";
      li.innerHTML = `
        <div class="min-w-0">
          <div class="font-medium truncate">${s.siteName} – ${s.district}</div>
          <div class="text-xs text-slate-500 truncate">${s.region} • ${s.category}</div>
        </div>
        <span class="shrink-0 text-[10px] uppercase bg-rose-100 text-rose-700 rounded px-2 py-0.5 border border-rose-200">No GPS</span>`;
      pointsList.appendChild(li);
    }

    // Seed all sites
    sites.forEach(s => {
      if (Number.isFinite(s.lat) && Number.isFinite(s.lng)) addDotForSite(s);
      else addListRowWithoutGPS(s);
    });

    // Fit to bounds if we have any plotted dots
    if (bounds.length) map.fitBounds(L.latLngBounds(bounds).pad(0.25));
    else map.setView([2.33, 42.28], 7); // fallback (Bardere area)

    // Locate Me
    document.getElementById('locateMe').addEventListener('click', () => {
      if (!navigator.geolocation) return alert("Geolocation not supported.");
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          const me = L.circleMarker([latitude, longitude], meStyle).addTo(map);
          me.bindPopup("<strong>You are here</strong>").openPopup();
          map.setView([latitude, longitude], 15, { animate: true });
        },
        () => alert("Couldn't get your location. Use https:// or localhost."),
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });
  </script>
</body>
</html>
