<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jubaland Sites – GPS Dots Map</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    #map { height: 100%; min-height: 420px; }
  </style>
</head>
<body class="bg-slate-100">
  <div id="app" class="h-screen grid md:grid-cols-[360px_1fr]">
    <!-- Sidebar -->
    <aside class="bg-white border-r border-slate-200 p-4 flex flex-col gap-4 overflow-y-auto">
      <header>
        <h1 class="text-xl font-bold text-slate-800">Jubaland Sites – GPS Dots</h1>
        <p class="text-sm text-slate-500">MoEWR-JSS & Line Ministries Sites (Water/Meat/Agriculture).</p>
      </header>

      <div class="space-y-3">
        <button id="locateMe"
          class="w-full rounded-xl bg-blue-600 px-4 py-2 text-white font-semibold shadow hover:bg-blue-500">
          Use My GPS Location
        </button>
      </div>

      <div class="mt-2">
        <h2 class="text-sm font-semibold text-slate-600 mb-2">Locations (click “Zoom”)</h2>
        <ul id="pointsList" class="space-y-2 text-sm text-slate-700"></ul>
      </div>

      <footer class="mt-auto text-xs text-slate-400">
        Tip: For GPS, open this page via <b>http://localhost</b> or <b>https://</b> (not file://).
      </footer>
    </aside>

    <!-- Map -->
    <main class="relative h-full">
      <div id="map" class="absolute inset-0 h-full"></div>
    </main>
  </div>

  <script>
    // --- All Jubaland Sites from Excel ---
    const sites = [
      { region: "Gedo", district: "Bardere", siteName: "Bardere Meat Market", lat: 2.336019, lng: 42.285309 },
      { region: "Gedo", district: "Dollow", siteName: "Dollow Meat Market", lat: 4.164040, lng: 42.090664 },
      { region: "Gedo", district: "Garbaharey", siteName: "Garbaharey Meat Market", lat: 3.331583, lng: 42.220376 },
      { region: "Gedo", district: "Luuq", siteName: "Luuq Milk Market", lat: 3.795055, lng: 42.544286 },
      { region: "Gedo", district: "Dollow", siteName: "Dollow Milk Market", lat: 4.163188, lng: 42.075776 },
      { region: "Gedo", district: "Luuq", siteName: "Hanoy", lat: 3.746533, lng: 42.543454 },
      { region: "Gedo", district: "Bardere", siteName: "Qalaliyow", lat: 2.352431, lng: 42.280226 },

      { region: "Lower Juba", district: "Kismayo", siteName: "Kismayo Main Slaughter House", lat: -0.380132, lng: 42.517515 },
      { region: "Lower Juba", district: "Kismayo", siteName: "Qeys Fishery Company (Fanole Fishing)", lat: -0.368840, lng: 42.550833 },
      { region: "Lower Juba", district: "Kismayo", siteName: "Kibora Fishing Company", lat: -0.365837, lng: 42.541756 },
      { region: "Lower Juba", district: "Afmadow", siteName: "Tacab Wadaag", lat: 0.057523, lng: 42.340128 },
      { region: "Lower Juba", district: "Afmadow", siteName: "Jandash Argo Farm", lat: 0.061923, lng: 42.352618 },
      { region: "Lower Juba", district: "Badhaadhe", siteName: "Badhaadhe Desalination Central", lat: 1.389348, lng: 41.345896 },

      { region: "Middle Juba", district: "Bu'aale", siteName: "Dhasheeg Cooperative For Agriculture, Livestock", lat: 0.047222, lng: 42.395278 },
      { region: "Middle Juba", district: "Bu'aale", siteName: "Liban Mohamed Isse", lat: 3.841378, lng: 42.551892 },
      { region: "Middle Juba", district: "Saakow", siteName: "Dhasheeg Cooperative Solutions", lat: -0.050833, lng: 42.549549 },
      { region: "Middle Juba", district: "Jilib", siteName: "Gumar Farm", lat: 2.318140, lng: 42.126902 }
    ];

    // --- Map setup ---
    const map = L.map('map', { zoomControl: true, attributionControl: true });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 20,
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Region color coding
    const regionColors = {
      "Gedo": "#2563eb",
      "Lower Juba": "#16a34a",
      "Middle Juba": "#9333ea"
    };

    const bounds = [];
    const pointsList = document.getElementById('pointsList');

    function addDotForSite(s) {
      const color = regionColors[s.region] || "#2563eb";
      const m = L.circleMarker([s.lat, s.lng], {
        radius: 6,
        color: "#1f2937",
        fillColor: color,
        fillOpacity: 0.9,
        weight: 1
      }).addTo(map).bindPopup(`
        <div class="text-sm">
          <div class="font-semibold">${s.siteName}</div>
          <div class="text-slate-600">${s.district}, ${s.region}</div>
          <div class="mt-1 text-slate-500">${s.lat.toFixed(6)}, ${s.lng.toFixed(6)}</div>
        </div>`);

      bounds.push([s.lat, s.lng]);

      const li = document.createElement('li');
      li.className = "flex items-center justify-between gap-3 rounded-lg bg-slate-50 border border-slate-200 px-2 py-1";
      li.innerHTML = `
        <div class="min-w-0">
          <div class="font-medium truncate">${s.siteName} – ${s.district}</div>
          <div class="text-xs text-slate-500 truncate">${s.region} • ${s.lat.toFixed(5)}, ${s.lng.toFixed(5)}</div>
        </div>
        <button class="shrink-0 text-blue-600 hover:underline text-xs">Zoom</button>`;
      li.querySelector('button').addEventListener('click', () => {
        map.setView([s.lat, s.lng], 14, { animate: true });
        m.openPopup();
      });
      pointsList.appendChild(li);
    }

    sites.forEach(addDotForSite);

    if (bounds.length) map.fitBounds(L.latLngBounds(bounds).pad(0.25));
    else map.setView([2.33, 42.28], 7);

    document.getElementById('locateMe').addEventListener('click', () => {
      if (!navigator.geolocation) return alert("Geolocation not supported.");
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          const me = L.circleMarker([latitude, longitude], {
            radius: 7,
            color: "#064e3b",
            fillColor: "#10b981",
            fillOpacity: 0.95,
            weight: 2
          }).addTo(map);
          me.bindPopup("<strong>You are here</strong>").openPopup();
          map.setView([latitude, longitude], 15, { animate: true });
        },
        () => alert("Couldn't get your location. Use https:// or localhost."),
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    });
  </script>
</body>
</html>
